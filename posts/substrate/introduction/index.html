<!DOCTYPE html>
<html lang="en"><head>
	<meta charset="UTF-8">
	<meta name="description" content="Interested in Blockchains, Cryptography and Distributed Systems.">
	<meta name="keywords" content="computer, security, ethical hacker, researcher, inventor, abertay, dundee, edinburgh, machine learning, mathematics, cryptography, blockchains, reverse engineering, linux, programming, scotland, greg hill">
	<meta name="author" content="Gregory Hill">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Gregory Hill | Substrate &amp; Ink</title>
	<link href="/css/style.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
	<link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="img/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="/img/manifest.json">
	<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
	<link rel="shortcut icon" href="/img/favicon.ico">
	<meta name="msapplication-config" content="/img/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">
</head><body>
    <main><div class="post">
    <div class="post-info">
        
            Apr 8, 2020
            · 608 words
            · 3 minute read
        
    </div>

    <h1 class="post-title">
        Substrate &amp; Ink
    </h1>

    <div class="post-tags"><a class="tag" href=/tags/substrate/>#substrate</a><a class="tag" href=/tags/ink/>#ink</a><a class="tag" href=/tags/rust/>#rust</a></div>

    <p>To interact with Polkadot, there are three envisioned development trajectories; a parachain implements it&rsquo;s own runtime logic (think custom sidechain), a parathread is similar but only produces a block when absolutely necessary to update the relay chain, and a smart contract can run atop any chain with the correct execution environment. Substrate enables the former methodology based on a modular architecture with pluggable consensus and Parity maintain an embedded Domain Specific Language (eDSL) atop Substrate for WASM smart contracts.</p>
<p>As of the time of writing, interchain support is not yet finalized. Once complete, anything developed with Substrate will be able to communicate with the ecosystem through <a href="https://github.com/paritytech/cumulus">Cumulus</a> using <a href="https://wiki.polkadot.network/docs/en/learn-crosschain">Cross-chain Message Passing</a>. <a href="https://wiki.polkadot.network/docs/en/maintain-collator">Collators</a> will forward transactions from a designated parachain to the <a href="https://wiki.polkadot.network/docs/en/learn-architecture#relay-chain">relay chain</a> to benefit from <em>pooled security</em>. Each parachain slot on the relay chain will have a registered State Transition Function (STF) that validates the bundled transactions.</p>
<p>In this post I will demonstrate how to implement a custom parachain runtime versus an equivalent on layer two. To interact with the examples it will be helpful to open the official <a href="https://polkadot.js.org/apps/">Polkadot UI</a> on a supported browser or run it locally:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker run --rm -it --name polkadot-ui -p 80:80 chevdor/polkadot-ui:latest
</code></pre></div><h2 id="substrate">Substrate</h2>
<p>The <a href="https://github.com/substrate-developer-hub/substrate-node-template">template repository</a> is the main starting point for developing a custom runtime. Ensure that you have the required dependencies installed before continuing, namely <a href="https://www.rust-lang.org/tools/install">Rust</a> and the <a href="https://github.com/rust-lang/rust/pull/46115#issuecomment-345727266">WebAssembly backend</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone -b v2.0.0-alpha.3 --depth <span style="color:#ae81ff">1</span> https://github.com/substrate-developer-hub/substrate-node-template
cd substrate-node-template
</code></pre></div><p>In the <code>substrate-node-template</code> directory, create a new file <code>runtime/src/flip.rs</code> and copy the following source into it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">use</span> frame_support::{
    decl_module, decl_storage,
    dispatch::{DispatchResult},
};

<span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Trait: <span style="color:#a6e22e">system</span>::Trait {
}

decl_storage<span style="color:#f92672">!</span> {
    <span style="color:#66d9ef">trait</span> Store <span style="color:#66d9ef">for</span> Module<span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">Trait</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">as</span> flipper {
        <span style="color:#66d9ef">pub</span> Value get(value): <span style="color:#66d9ef">bool</span>;
    }
}

decl_module<span style="color:#f92672">!</span> {
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Module</span><span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">Trait</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">Call</span> <span style="color:#66d9ef">where</span> origin: <span style="color:#a6e22e">T</span>::Origin {
        <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">flip</span>(_origin) -&gt; <span style="color:#a6e22e">DispatchResult</span> {
            <span style="color:#f92672">&lt;</span>Value<span style="color:#f92672">&gt;</span>::put(<span style="color:#f92672">!&lt;</span>Value<span style="color:#f92672">&gt;</span>::get());
            Ok(())
        }
    }
}
</code></pre></div><p>Edit <code>runtime/src/lib.rs</code> to include our new runtime module as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">mod</span> flip;

<span style="color:#66d9ef">impl</span> flip::Trait <span style="color:#66d9ef">for</span> Runtime {
}

construct_runtime<span style="color:#f92672">!</span>(
    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">Runtime</span> <span style="color:#66d9ef">where</span>
        Block <span style="color:#f92672">=</span> Block,
        ...
    {
        ...
        Flip: <span style="color:#a6e22e">flip</span>::{Module, Call, Storage},
    }
);
</code></pre></div><p>We&rsquo;re ready to compile and run our first node runtime!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cargo build --release
./target/release/node-template --dev
</code></pre></div><p>Navigate to the <code>Extrinsics</code> tab in the sidebar of the UI and trigger <code>flip.flip()</code>, you should notice in the <code>Chain state</code> tab that <code>flip.value()</code> will change each time the aforementioned action is triggered.</p>
<h2 id="ink">Ink</h2>
<p>This section is an excerpt from the official tutorial <a href="https://substrate.dev/substrate-contracts-workshop/#/">here</a> which you may find more useful. Otherwise run the following commands to download and compile the example contract:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cargo install cargo-contract --vers 0.6.0 --force
cargo contract new flipper
cd flipper
cargo +nightly test
cargo +nightly contract build
cargo +nightly contract generate-metadata
</code></pre></div><p>Unless using a custom node runtime with the <a href="https://github.com/paritytech/substrate/tree/master/frame/contracts">contracts</a> pallet, it is possible to use the main substrate node runtime for smart contract development:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">substrate --dev
</code></pre></div><p>Reload the UI and navigate to the <code>Contracts</code> tab in the sidebar. Click <code>Upload WASM</code> and specify <code>flipper.wasm</code> and <code>metadata.json</code> for the contract and ABI respectively.</p>
<h2 id="other">Other</h2>
<p>One of the core developers has a great post which describes how to <a href="https://www.shawntabrizi.com/substrate/querying-substrate-storage-via-rpc/">interact with the JSON RPC</a>. In short, if you call the following method over HTTP, your node should return a list of all the methods it supports:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> -d <span style="color:#e6db74">&#39;{&#34;id&#34;:1, &#34;jsonrpc&#34;:&#34;2.0&#34;, &#34;method&#34;: &#34;rpc_methods&#34;}&#39;</span> http://localhost:9933/
</code></pre></div><h2 id="glossary">Glossary</h2>
<h3 id="extrinsicshttpssubstratedevdocsenconceptualnodeextrinsics"><a href="https://substrate.dev/docs/en/conceptual/node/extrinsics">Extrinsics</a></h3>
<p>Anything that ingresses into the chain is an extrinsic, namely inherents (information inserted by a block producer), signed or unsigned transactions.</p>
<h3 id="framehttpssubstratedevdocsenconceptualruntimeframe"><a href="https://substrate.dev/docs/en/conceptual/runtime/frame">FRAME</a></h3>
<p>The Framework for Runtime Aggregation of Modularized Entities (FRAME) describes a set of modules, known as pallets, linked by support libraries.
Pallets are the domain specific dependencies of Substrate - crates that only work within the context of a node.</p>

</div></main>
</body><footer>

    
        <a class="footer-social" href="https://github.com/gregdhill">
            <i class="grow fa fa-github fa-2x" aria-hidden="true"></i>
        </a>
    
        <a class="footer-social" href="https://twitter.com/gregorydhill">
            <i class="grow fa fa-twitter fa-2x" aria-hidden="true"></i>
        </a>
    
        <a class="footer-social" href="https://scholar.google.co.uk/citations?user=OoKiidsAAAAJ&amp;hl=en">
            <i class="grow fa fa-graduation-cap fa-2x" aria-hidden="true"></i>
        </a>
    

</footer></html>