<!DOCTYPE html>
<html lang="en"><head>
	<meta charset="UTF-8">
	<meta name="description" content="Interested in Blockchains, Cryptography and Distributed Systems.">
	<meta name="keywords" content="computer, security, ethical hacker, researcher, inventor, abertay, dundee, edinburgh, machine learning, mathematics, cryptography, blockchains, reverse engineering, linux, programming, scotland, greg hill">
	<meta name="author" content="Gregory Hill">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Gregory Hill | Containerizing Bitcoin</title>
	<link href="../../../css/style.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="apple-touch-icon" sizes="180x180" href="../../../img/apple-touch-icon.png">
	<link rel="icon" type="image/png" href="../../../img/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="../../../img/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="../../../img/manifest.json">
	<link rel="mask-icon" href="../../../img/safari-pinned-tab.svg" color="#5bbad5">
	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<meta name="msapplication-config" content="/img/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">
</head><body>
    <main><div class="post">
    <div class="post-info">
        
            Apr 10, 2020
            · 302 words
            · 2 minute read
        
    </div>

    <h1 class="post-title">
        Containerizing Bitcoin
    </h1>

    <div class="post-tags"><a class="tag" href=../../../tags/bitcoin/>#bitcoin</a><a class="tag" href=../../../tags/docker/>#docker</a></div>

    <div class="post-body">
        <p>There are over 500,000 lines of code in Bitcoin Core, roughly 70% of which is pure C++. Compile times vary, but if you just want to get a node up and running, docker is the easiest way to go. Here&rsquo;s something I prepared <a href="https://github.com/gregdhill/bitcoin-docker">earlier</a>&hellip;</p>
<p>Courtesy of the <a href="https://github.com/bitcoin/bitcoin/blob/master/doc/build-unix.md#to-build">official docs</a>, there are only four commands to run which build <code>bitcoind</code>, <code>bitcoin-cli</code> and <code>bitcoin-qt</code>. The dependencies are clearly outlined for different architectures - including OSx, Windows and Unix flavours - but in my Dockerfile I have chosen to extend Ubuntu. Checkout the repository linked above to build the image yourself or use <code>gregdhill/bitcoin:latest</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">node_1</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">gregdhill/bitcoin:latest</span>
    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8333:8333&#34;</span>
    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">bitcoind -regtest -port=8333 -rpcport=18443 -rpcuser=admin -rpcpassword=admin</span>
  <span style="color:#f92672">node_2</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">gregdhill/bitcoin:latest</span>
    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8334:8334&#34;</span>
    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">bitcoind -regtest -port=8334 -rpcport=18444 -rpcuser=admin -rpcpassword=admin -addnode=127.0.0.1:8333</span>
    <span style="color:#f92672">depends_on</span>: 
    - <span style="color:#ae81ff">node_1</span>
  <span style="color:#f92672">node_3</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">gregdhill/bitcoin:latest</span>
    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8335:8335&#34;</span>
    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">bitcoind -regtest -port=8335 -rpcport=18445 -rpcuser=admin -rpcpassword=admin -addnode=127.0.0.1:8333</span>
    <span style="color:#f92672">depends_on</span>: 
    - <span style="color:#ae81ff">node_1</span>
  <span style="color:#f92672">node_4</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">gregdhill/bitcoin:latest</span>
    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8336:8336&#34;</span>
    <span style="color:#f92672">command</span>: <span style="color:#ae81ff">bitcoind -regtest -port=8336 -rpcport=18446 -rpcuser=admin -rpcpassword=admin -addnode=127.0.0.1:8333</span>
    <span style="color:#f92672">depends_on</span>: 
    - <span style="color:#ae81ff">node_1</span>
</code></pre></div><p>Save the source above as <code>docker-compose.yaml</code> and run <code>docker-compose up</code> to start a local four node network running in <a href="https://bitcoin.org/en/glossary/regression-test-mode">regression test mode</a>. With this, it is possible to generate new blocks instantaneously through the JSON RPC. We can utilise <code>bitcoin-cli</code> from the same docker image to create an arbitrary number of transactions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">address<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>docker run --network<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;host&#34;</span> gregdhill/bitcoin:latest bitcoin-cli -rpcpassword<span style="color:#f92672">=</span>admin -rpcuser<span style="color:#f92672">=</span>admin -regtest getnewaddress<span style="color:#66d9ef">)</span>
docker run --network<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;host&#34;</span> gregdhill/bitcoin:latest bitcoin-cli -rpcpassword<span style="color:#f92672">=</span>admin -rpcuser<span style="color:#f92672">=</span>admin -regtest generatetoaddress <span style="color:#ae81ff">100</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>address<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</code></pre></div><p>If we query the same RPC manually, we can observe the latest block height via <code>getmininginfo</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl --user admin:admin -H <span style="color:#e6db74">&#39;content-type:text/plain;&#39;</span> --data-binary <span style="color:#e6db74">&#39;{&#34;id&#34;:&#34;1&#34;, &#34;jsonrpc&#34;:&#34;1.0&#34;, &#34;method&#34;: &#34;getmininginfo&#34;, &#34;params&#34;:[]}&#39;</span>  http://localhost:18443
</code></pre></div><p>Alternatively we can verify that the node has four peers total (including itself) using the <code>getpeerinfo</code> method.</p>
<p>For a full list of methods, <a href="https://en.bitcoin.it/wiki/Original_Bitcoin_client/API_calls_list">checkout the wiki</a>.</p>

    </div>
</div></main>
</body><footer>

    
        <a class="footer-social" href="https://github.com/gregdhill">
            <i class="grow fa fa-github fa-2x" aria-hidden="true"></i>
        </a>
    
        <a class="footer-social" href="https://twitter.com/gregorydhill">
            <i class="grow fa fa-twitter fa-2x" aria-hidden="true"></i>
        </a>
    
        <a class="footer-social" href="https://scholar.google.co.uk/citations?user=OoKiidsAAAAJ&amp;hl=en">
            <i class="grow fa fa-graduation-cap fa-2x" aria-hidden="true"></i>
        </a>
    

</footer></html>